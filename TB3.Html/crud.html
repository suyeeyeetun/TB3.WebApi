<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div>
      <div class="mb-3">
        <label for="txtText" class="form-label">Title</label>
        <input type="text" class="form-control" id="txtTitle" />
      </div>
      <div class="mb-3">
        <label for="txtAuthor" class="form-label">Author</label>
        <input type="text" class="form-control" id="txtAuthor" />
      </div>
      <div class="mb-3">
        <label for="txtContent" class="form-label">Content</label>
        <input class="form-control" id="txtContent" type="text" />
      </div>
      <button type="button" id="btnSave" class="btn btn-success">Save</button>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">No.</th>
          <th scope="col">ID</th>
          <th scope="col">Title</th>
          <th scope="col">Author</th>
          <th scope="col">Content</th>
        </tr>
      </thead>
      <tbody id="tbData">
        <!-- <tr>
      <th scope="row">
        <button type="button" class="btn btn-edit">Edit</button>
        <button type="button" class="btn btn-delete">Delete</button>
      </th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr> -->
      </tbody>
    </table>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>
      loadData();
      function loadData() {
        let blog = localStorage.getItem("Blogs");
        if (blog == null) return;
        blog = JSON.parse(blog);
        let trRows = "";
        for (let i = 0; i < blog.length; i++) {
          const item = blog[i];
          // console.log(item);
          trRows += `
          <tr>
      <th scope="row">
        <button type="button" class="btn btn-warning" onclick="editData('${
          item.ID
        }')">Edit</button>
                    <button type="button" class="btn btn-danger" onclick="deleteData('${
                      item.ID
                    }')">Delete</button>
      </th>
      <td>${i + 1}</td>
      <td>${item.ID}</td>
      <td>${item.Title}</td>
      <td>${item.Author}</td>
      <td>${item.Content}</td>
    </tr>
          `;
        }
        $("#tbData").html(trRows);
        // localStorage.removeItem("Blogs");
      }

      $("#txtTitle").focus();

      $("#btnSave").click(function () {
        
        if(editId == null){
          saveData();
        }else{
          updateData();
        }
        editId = null;
        $("#txtTitle").val("");
        $("#txtAuthor").val("");
        $("#txtContent").val("");
        $("#txtTitle").focus();
        loadData();
      });

      //Save Data
      function saveData(){
        const title = $("#txtTitle").val();
        if (title == null || title == "") {
          alert("Please enter the title");
          $("#txtTitle").focus();
          return;
        }
        const author = $("#txtAuthor").val();
        if (author == null || author == "") {
          alert("Please enter the author");
          $("#txtAuthor").focus();
          return;
        }
        const content = $("#txtContent").val();
        if (content == null || content == "") {
          alert("Please enter the title");
          $("#txtContent").focus();
          return;
        }
        const uuid = crypto.randomUUID();
        const item = {
          ID: uuid,
          Title: title,
          Author: author,
          Content: content,
        };
         let lst = [];
        let data = localStorage.getItem("Blogs");
        if (data == null) {
          lst = [];
        } else {
          lst = JSON.parse(data);
        }
        lst.push(item);
        const json = JSON.stringify(lst);
        localStorage.setItem("Blogs", json);

        alert("Saving Successful");
      }
      function updateData(){
        const title = $('#txtTitle').val();
            if (title == null || title == '') {
                alert("Please enter title.");
                $('#txtTitle').focus();
                return;
            }

            const author = $('#txtAuthor').val();
            if (author == null || author == '') {
                alert("Please enter author.");
                $('#txtAuthor').focus();
                return;
            }

            const content = $('#txtContent').val();
            if (content == null || content == '') {
                alert("Please enter content.");
                $('#txtContent').focus();
                return;
            }
            let lst = getData();
            let index = lst.findIndex(x => x.ID == editId);
            if(index == -1){
              return;
            }
            lst[index].Title = title;
            lst[index].Author = author;
            lst[index].Content = content;
            const json = JSON.stringify(lst); // json object to json string
            localStorage.setItem("Blogs", json);

            alert('Updating Successful.');
      }
      let editId = null;
      function editData(id){
        alert(id)
         let lst = getData();

            let result = lst.filter(x => x.ID == id); // [{}], [{},{}]

            if (result.length == 0) {
                alert('No data found.');
                return;
            }

            let item = result[0];

            editId = item.ID;
            $('#txtTitle').val(item.Title);
            $('#txtAuthor').val(item.Author);
            $('#txtContent').val(item.Content);
      }
 

      //Get Data
      function getData() {
        let lst = [];
        let data = localStorage.getItem("Blogs");
        if (data == null) {
          lst = [];
        } else {
          lst = JSON.parse(data);
        }
        return lst;
      }

      //Delete Data
      function deleteData(id) {
        let confirmResult = confirm("Are you sure to delete?");
        if (confirmResult == false) return;

        let lst = getData();
        // lst = lst.filter(x => x.ID != id);
           lst = lst.filter(x => x.ID != id);
        const json = JSON.stringify(lst);
        localStorage.setItem("Blogs", json);
        console.log("Deleting Successful");
        loadData();
      }
     
    </script>
  </body>
</html>
